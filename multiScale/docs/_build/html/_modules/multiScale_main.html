<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>multiScale_main &mdash; self-driving multi-scale imaging 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=359c27e9"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            self-driving multi-scale imaging
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">self-driving multi-scale imaging</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">multiScale_main</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for multiScale_main</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="nn">tk</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">ttk</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">from</span> <span class="nn">gui.main_window</span> <span class="kn">import</span> <span class="n">MultiScope_MainGui</span>
<span class="kn">from</span> <span class="nn">multiScope</span> <span class="kn">import</span> <span class="n">multiScopeModel</span>
<span class="kn">import</span> <span class="nn">auxiliary_code.concurrency_tools</span> <span class="k">as</span> <span class="nn">ct</span>
<span class="kn">import</span> <span class="nn">auxiliary_code.write_parameters</span> <span class="k">as</span> <span class="nn">write_params</span>
<span class="kn">from</span> <span class="nn">auxiliary_code.constants</span> <span class="kn">import</span> <span class="n">Camera_parameters</span>
<span class="kn">from</span> <span class="nn">auxiliary_code.constants</span> <span class="kn">import</span> <span class="n">NI_board_parameters</span>
<span class="kn">from</span> <span class="nn">auxiliary_code.constants</span> <span class="kn">import</span> <span class="n">FileSave_parameters</span>
<span class="kn">from</span> <span class="nn">auxiliary_code.constants</span> <span class="kn">import</span> <span class="n">ASLM_parameters</span>
<span class="kn">from</span> <span class="nn">automated_microscopy.drift_correction</span> <span class="kn">import</span> <span class="n">drift_correction</span>
<span class="kn">from</span> <span class="nn">automated_microscopy.image_deposit</span> <span class="kn">import</span> <span class="n">images_InMemory_class</span>

<div class="viewcode-block" id="MultiScale_Microscope_Controller"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller">[docs]</a><span class="k">class</span> <span class="nc">MultiScale_Microscope_Controller</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the controller in an MVC-scheme for mediating the interaction between the View (GUI) and the model (multiScope.py).</span>
<span class="sd">    Use: https://www.python-course.eu/tkinter_events_binds.php</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#todo: check that stage values - e.g. with plane spacing, plane number don&#39;t expand beyond the possible travel range</span>
    <span class="c1">#todo: move to selected region in high resolution.</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>

        <span class="c1"># Create scope object as model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">multiScopeModel</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;model initiated&quot;</span><span class="p">)</span>

        <span class="c1">#create the gui as view</span>
        <span class="n">all_tabs_mainGUI</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Notebook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">MultiScope_MainGui</span><span class="p">(</span><span class="n">all_tabs_mainGUI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

        <span class="c1">#init param file writer class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paramwriter</span> <span class="o">=</span> <span class="n">write_params</span><span class="o">.</span><span class="n">write_Params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">)</span>

        <span class="c1">#init drift correction module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageRepo</span> <span class="o">=</span> <span class="n">images_InMemory_class</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ImageRepo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageRepo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drift_correctionmodule</span> <span class="o">=</span> <span class="n">drift_correction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lowres_planespacing</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">highres_planespacing</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_height</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_width</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_timepointstring</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">ImageRepo</span><span class="p">,</span>
                                                       <span class="n">debugfilepath</span><span class="o">=</span><span class="s2">&quot;D://test/drift_correctionTest/transmission_microscopeoutput_result&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">driftcorrectionmodule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_correctionmodule</span>

        <span class="c1">#define here which buttons run which function in the multiScope model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">continuetimelapse</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#enable functionality to stop timelapse</span>

        <span class="c1">#######connect buttons / variables from GUI with functions here-----------------------------------</span>
        <span class="c1"># connect all the buttons that start a functionality like preview, stack acquisition, etc.</span>
        <span class="c1"># connect all the buttons that you want to dynamically change, e.g. during preview</span>

        <span class="c1">#preview buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_preview_lowres</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;ButtonRelease&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_lowrespreview</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_preview_highres</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;ButtonRelease&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_highrespreview</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_preview_stop</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_stop_preview</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_changeTo488</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changefilter</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;488&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_changeTo552</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changefilter</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;552&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_changeTo594</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changefilter</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;594&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_changeTo640</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changefilter</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;640&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_changeTo_block</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changefilter</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_changeTo_trans</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changefilter</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;LED&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">preview_autoIntensity</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updatepreview</span><span class="p">)</span>

        <span class="c1">#stack run buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_bt_run_stack</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquire_stack</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_bt_abort_stack</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_stack</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_numberOfPlanes_highres</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_stack_aq_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_numberOfPlanes_lowres</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_stack_aq_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_plane_spacing_lowres</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_stack_aq_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_plane_spacing_highres</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_stack_aq_parameters</span><span class="p">)</span>

        <span class="c1">#timelapse run buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_bt_run_timelapse</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquire_timelapse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_bt_abort_timelapse</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_timelapse</span><span class="p">)</span>

        <span class="c1">#laser settings sliders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser488_percentage_LR</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLowResLaserParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser552_percentage_LR</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLowResLaserParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser594_percentage_LR</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLowResLaserParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser640_percentage_LR</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLowResLaserParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser488_percentage_HR</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateHighResLaserParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser552_percentage_HR</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateHighResLaserParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser594_percentage_HR</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateHighResLaserParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser640_percentage_HR</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateHighResLaserParameters</span><span class="p">)</span>

        <span class="c1">#camera settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">cam_lowresExposure</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateExposureParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">cam_highresExposure</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateExposureParameters</span><span class="p">)</span>

        <span class="c1">#roi settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_applybutton</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeROI</span><span class="p">)</span>

        <span class="c1">#stage settings tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_axial</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">movestage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_lateral</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">movestage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_updown</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">movestage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_angle</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">movestage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">keyboard_input_on_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_keyboard_movement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">keyboard_input_off_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_keyboard_movement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">move_to_specificPosition_Button</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">movestageToPosition</span><span class="p">)</span>

        <span class="c1">#advanced settings tab</span>
        <span class="c1">#self.view.advancedSettingstab.slit_currentsetting.trace_add(&quot;write&quot;, self.slit_opening_move)</span>
        <span class="c1">#self.view.advancedSettingstab.slit_lowres.trace_add(&quot;write&quot;, self.updateSlitParameters)</span>
        <span class="c1">#self.view.advancedSettingstab.slit_highres.trace_add(&quot;write&quot;, self.updateSlitParameters)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">stack_aq_stage_velocity</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_stack_aq_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">stack_aq_stage_acceleration</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_stack_aq_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">stack_aq_camera_delay</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_stack_aq_parameters</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_volt_current</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_ASLMParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_alignmentmodeOn</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_ASLMParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_SawToothOn</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_ASLMParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_constantVoltageOn</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_ASLMParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_volt_interval</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_ASLMParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_volt_middle488</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_ASLMParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_volt_middle552</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_ASLMParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_volt_middle594</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_ASLMParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_volt_middle640</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_ASLMParameters</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_voltageDirection</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_ASLMParameters</span><span class="p">)</span>
        <span class="c1">#self.view.advancedSettingstab.adv_settings_mSPIMvoltage.trace_add(&quot;write&quot;, self.update_mSPIMvoltage)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_scanWidth</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_ASLMParameters</span><span class="p">)</span>

        <span class="c1"># smart settings tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">drift_correction_highres</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateDriftCorrectionSettings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">drift_correction_lowres</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateDriftCorrectionSettings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">driftcorrection_488</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateDriftCorrectionSettings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">driftcorrection_552</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateDriftCorrectionSettings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">driftcorrection_594</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateDriftCorrectionSettings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">driftcorrection_640</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateDriftCorrectionSettings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">driftcorrection_LED</span><span class="o">.</span><span class="n">trace_add</span><span class="p">(</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateDriftCorrectionSettings</span><span class="p">)</span>

        <span class="c1">#define some parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_laser</span> <span class="o">=</span> <span class="s2">&quot;488&quot;</span>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.run"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the Tkinter Gui in the main loop</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Multi-scale microscope V1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;800x600&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">resizable</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#self.automatically_update_stackbuffer()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.close"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">LED_voltage</span><span class="o">.</span><span class="n">setconstantvoltage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.updateLowResLaserParameters"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.updateLowResLaserParameters">[docs]</a>    <span class="k">def</span> <span class="nf">updateLowResLaserParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">indx</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update the laser power</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get laser power from GUI and construct laser power setting array</span>
        <span class="c1"># multiply with 5 here as the laser is modulated within 0 to 5 V</span>
        <span class="n">voltage488_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser488_percentage_LR</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mf">100.</span>
        <span class="n">voltage552_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser552_percentage_LR</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mf">100.</span>
        <span class="n">voltage594_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser594_percentage_LR</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mf">100.</span>
        <span class="n">voltage640_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser640_percentage_LR</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mf">100.</span>
        <span class="n">power_settings_LR</span> <span class="o">=</span> <span class="p">[</span><span class="n">voltage488_LR</span><span class="p">,</span> <span class="n">voltage552_LR</span><span class="p">,</span> <span class="n">voltage594_LR</span><span class="p">,</span> <span class="n">voltage640_LR</span><span class="p">]</span>

        <span class="c1"># change laser power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lowres_laserpower</span><span class="o">=</span><span class="n">power_settings_LR</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.updateHighResLaserParameters"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.updateHighResLaserParameters">[docs]</a>    <span class="k">def</span> <span class="nf">updateHighResLaserParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">indx</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update the laser power</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">voltage488_HR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser488_percentage_HR</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mf">100.</span>
        <span class="n">voltage552_HR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser552_percentage_HR</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mf">100.</span>
        <span class="n">voltage594_HR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser594_percentage_HR</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mf">100.</span>
        <span class="n">voltage640_HR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">laser640_percentage_HR</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mf">100.</span>
        <span class="n">power_settings_HR</span> <span class="o">=</span> <span class="p">[</span><span class="n">voltage488_HR</span><span class="p">,</span> <span class="n">voltage552_HR</span><span class="p">,</span> <span class="n">voltage594_HR</span><span class="p">,</span> <span class="n">voltage640_HR</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">highres_laserpower</span><span class="o">=</span><span class="n">power_settings_HR</span></div>

    <span class="c1"># def updateSlitParameters(self, var, indx, mode):</span>
    <span class="c1">#     # set the low resolution and high-resolution slit openings</span>
    <span class="c1">#     self.model.slitopening_lowres = self.view.advancedSettingstab.slit_lowres.get()</span>
    <span class="c1">#     self.model.slitopening_highres = self.view.advancedSettingstab.slit_highres.get()</span>

    <span class="c1"># def update_mSPIMvoltage(self, var, indx, mode):</span>
    <span class="c1">#     # set the voltage for the mSPIM mirror</span>
    <span class="c1">#     voltage = self.view.advancedSettingstab.adv_settings_mSPIMvoltage.get()</span>
    <span class="c1">#     print(voltage)</span>
    <span class="c1">#     if voltage &gt; 0 and voltage &lt; NI_board_parameters.max_mSPIM_constant:</span>
    <span class="c1">#         self.model.mSPIMmirror_voltage.setconstantvoltage(voltage)</span>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.updateExposureParameters"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.updateExposureParameters">[docs]</a>    <span class="k">def</span> <span class="nf">updateExposureParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">indx</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="c1"># exposure time</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">cam_lowresExposure</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exposure_time_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">cam_lowresExposure</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">cam_highresExposure</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exposure_time_HR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">cam_highresExposure</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>  <span class="c1"># set exposure time</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;updated exposure time&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.update_stack_aq_parameters"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.update_stack_aq_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">update_stack_aq_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">indx</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="c1">#advanced stack acquisition parameters from advanced settings tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">delay_cameratrigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">stack_aq_camera_delay</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span> <span class="c1">#divide by 1000 - from ms to seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">highres_planespacing</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_plane_spacing_highres</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lowres_planespacing</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_plane_spacing_lowres</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">stack_nbplanes_highres</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_numberOfPlanes_highres</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">stack_nbplanes_lowres</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_numberOfPlanes_lowres</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">slow_velocity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">stack_aq_stage_velocity</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">slow_acceleration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">stack_aq_stage_acceleration</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stack acquisition settings updated&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.update_ASLMParameters"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.update_ASLMParameters">[docs]</a>    <span class="k">def</span> <span class="nf">update_ASLMParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">indx</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="c1"># get remote mirror voltage from GUI and update model parameter, also check for boundaries</span>
        <span class="n">minVol</span> <span class="o">=</span> <span class="n">ASLM_parameters</span><span class="o">.</span><span class="n">remote_mirror_minVol</span>
        <span class="n">maxVol</span> <span class="o">=</span> <span class="n">ASLM_parameters</span><span class="o">.</span><span class="n">remote_mirror_maxVol</span>
        <span class="c1">#</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_volt_interval</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
            <span class="n">middle_range488</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_volt_middle488</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
            <span class="n">middle_range552</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_volt_middle552</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
            <span class="n">middle_range594</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_volt_middle594</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
            <span class="n">middle_range640</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_volt_middle640</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
            <span class="n">middle_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">middle_range488</span><span class="p">,</span> <span class="n">middle_range552</span><span class="p">,</span> <span class="n">middle_range594</span><span class="p">,</span> <span class="n">middle_range640</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">middle_range</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="c1">#</span>

        <span class="n">setvoltage_first</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">setvoltage_second</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_voltageDirection</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;highTolow&#39;</span><span class="p">:</span>
            <span class="n">setvoltage_first</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">interval</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">middle_range</span><span class="p">]</span>
            <span class="n">setvoltage_second</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">interval</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">middle_range</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">setvoltage_first</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">interval</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">middle_range</span><span class="p">]</span>
            <span class="n">setvoltage_second</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">interval</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">middle_range</span><span class="p">]</span>

        <span class="c1">#check boundaries</span>
        <span class="n">setvoltage_first</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">maxVol</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">setvoltage_first</span><span class="p">,</span> <span class="n">minVol</span><span class="p">))</span>
        <span class="n">setvoltage_second</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">maxVol</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">setvoltage_second</span><span class="p">,</span> <span class="n">minVol</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ASLM_from_Volt</span> <span class="o">=</span> <span class="n">setvoltage_first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ASLM_to_Volt</span> <span class="o">=</span> <span class="n">setvoltage_second</span>
        <span class="c1"># display calculated voltages</span>
        <span class="c1">#self.view.advancedSettingstab.voltage_minIndicator.config(text=str(round(self.model.ASLM_from_Volt,5)))</span>
        <span class="c1">#self.view.advancedSettingstab.voltage_maxIndicator.config(text=str(round(self.model.ASLM_to_Volt, 5)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ASLM_from_Volt</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ASLM_to_Volt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ASLM_currentVolt</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">maxVol</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">minVol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_volt_current</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span>

        <span class="c1"># update the ASLM alignment settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ASLM_alignmentOn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_alignmentmodeOn</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ASLM_alignmentOn</span><span class="p">)</span>

        <span class="c1">#update scanwidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ASLM_scanWidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">advancedSettingstab</span><span class="o">.</span><span class="n">ASLM_scanWidth</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.updateDriftCorrectionSettings"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.updateDriftCorrectionSettings">[docs]</a>    <span class="k">def</span> <span class="nf">updateDriftCorrectionSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">indx</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        update settings of the drift correction</span>
<span class="sd">        :return: settings updated in model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#determine whether drift correction is active; and on which channel</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;drift correction settings updated&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">drift_correctionOnHighRes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">drift_correction_highres</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>  <span class="c1"># parameter whether high res drift correction is enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">drift_correctionOnLowRes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">drift_correction_lowres</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>  <span class="c1"># parameter whether low res drift correction is enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">drift_which_channels</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">driftcorrection_488</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">driftcorrection_552</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">driftcorrection_594</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">driftcorrection_640</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">driftcorrection_LED</span><span class="o">.</span><span class="n">get</span><span class="p">()]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">driftcorrection_LED</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">drift_transmission</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">drift_transmission</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="MultiScale_Microscope_Controller.updateGUItext"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.updateGUItext">[docs]</a>    <span class="k">def</span> <span class="nf">updateGUItext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        update text labes in GUI here</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">currentFPS</span> <span class="c1">#todo</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.changeROI"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.changeROI">[docs]</a>    <span class="k">def</span> <span class="nf">changeROI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        change the ROI - options (&#39;Full Chip&#39;, &#39;1024x1024&#39;, &#39;512x512&#39;, &#39;256x256&#39;, &#39;Custom&#39;)</span>

<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#which ROI selected</span>
        <span class="n">lowresstartx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lowresstarty</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_whichresolution</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;on&#39;</span><span class="p">:</span> <span class="c1">#low-resolution</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_lowres</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_ac_settings_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Full Chip&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_height</span> <span class="o">=</span> <span class="n">Camera_parameters</span><span class="o">.</span><span class="n">LR_height_pixel</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_width</span> <span class="o">=</span> <span class="n">Camera_parameters</span><span class="o">.</span><span class="n">LR_width_pixel</span>
                    <span class="n">lowresstartx</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">lowresstarty</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lowres_camera</span><span class="o">.</span><span class="n">set_imageroi</span><span class="p">(</span><span class="n">lowresstartx</span><span class="p">,</span><span class="n">lowresstarty</span><span class="p">,</span> <span class="n">Camera_parameters</span><span class="o">.</span><span class="n">LR_width_pixel</span><span class="p">,</span> <span class="n">Camera_parameters</span><span class="o">.</span><span class="n">LR_height_pixel</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_ac_settings_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;1024x1024&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_height</span> <span class="o">=</span> <span class="mi">1024</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_width</span> <span class="o">=</span> <span class="mi">1024</span>
                    <span class="n">lowresstartx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Camera_parameters</span><span class="o">.</span><span class="n">LR_width_pixel</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">512</span>
                    <span class="n">lowresstarty</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Camera_parameters</span><span class="o">.</span><span class="n">LR_height_pixel</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">512</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lowres_camera</span><span class="o">.</span><span class="n">set_imageroi</span><span class="p">(</span><span class="n">lowresstartx</span><span class="p">,</span><span class="n">lowresstarty</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_ac_settings_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;512x512&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_height</span> <span class="o">=</span> <span class="mi">512</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_width</span> <span class="o">=</span> <span class="mi">512</span>
                    <span class="n">lowresstartx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Camera_parameters</span><span class="o">.</span><span class="n">LR_width_pixel</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">256</span>
                    <span class="n">lowresstarty</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Camera_parameters</span><span class="o">.</span><span class="n">LR_height_pixel</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">256</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lowres_camera</span><span class="o">.</span><span class="n">set_imageroi</span><span class="p">(</span><span class="n">lowresstartx</span><span class="p">,</span><span class="n">lowresstarty</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_ac_settings_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Usual&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_height</span> <span class="o">=</span> <span class="mi">2960</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_width</span> <span class="o">=</span> <span class="mi">3816</span>
                    <span class="n">lowresstartx</span> <span class="o">=</span> <span class="mi">620</span>
                    <span class="n">lowresstarty</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lowres_camera</span><span class="o">.</span><span class="n">set_imageroi</span><span class="p">(</span><span class="mi">620</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3816</span><span class="p">,</span> <span class="mi">2960</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_ac_settings_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;256x256&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_height</span> <span class="o">=</span> <span class="mi">256</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_width</span> <span class="o">=</span> <span class="mi">256</span>
                    <span class="n">lowresstartx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Camera_parameters</span><span class="o">.</span><span class="n">LR_width_pixel</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">128</span>
                    <span class="n">lowresstarty</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Camera_parameters</span><span class="o">.</span><span class="n">LR_height_pixel</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">128</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lowres_camera</span><span class="o">.</span><span class="n">set_imageroi</span><span class="p">(</span><span class="n">lowresstartx</span><span class="p">,</span><span class="n">lowresstarty</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_ac_settings_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Custom&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_height</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_width</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                    <span class="n">lowresstartx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_startX</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                    <span class="n">lowresstarty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_startY</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lowres_camera</span><span class="o">.</span><span class="n">set_imageroi</span><span class="p">(</span><span class="n">lowresstartx</span><span class="p">,</span><span class="n">lowresstarty</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_height</span><span class="p">)</span>

            <span class="c1">#update calibration of drift correction module</span>
            <span class="n">x1_width</span> <span class="o">=</span> <span class="n">lowresstartx</span>
            <span class="n">x2_width</span> <span class="o">=</span> <span class="n">Camera_parameters</span><span class="o">.</span><span class="n">LR_width_pixel</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_width</span> <span class="o">-</span> <span class="n">lowresstartx</span>
            <span class="n">shiftvector_width</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">x2_width</span> <span class="o">-</span> <span class="n">x1_width</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drift_correctionmodule</span><span class="o">.</span><span class="n">calibration_width</span> <span class="o">=</span> <span class="n">Camera_parameters</span><span class="o">.</span><span class="n">low_to_highres_calibration_width</span> <span class="o">+</span> <span class="n">shiftvector_width</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;drift correction calibration width &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_correctionmodule</span><span class="o">.</span><span class="n">calibration_width</span><span class="p">))</span>
            <span class="n">x1_height</span> <span class="o">=</span> <span class="n">lowresstarty</span>
            <span class="n">x2_height</span> <span class="o">=</span> <span class="n">Camera_parameters</span><span class="o">.</span><span class="n">LR_height_pixel</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_height</span> <span class="o">-</span> <span class="n">lowresstarty</span>
            <span class="n">shiftvector_height</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">x2_height</span> <span class="o">-</span> <span class="n">x1_height</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drift_correctionmodule</span><span class="o">.</span><span class="n">calibration_height</span> <span class="o">=</span> <span class="n">Camera_parameters</span><span class="o">.</span><span class="n">low_to_highres_calibration_height</span> <span class="o">+</span> <span class="n">shiftvector_height</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;drift correction calibration height &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_correctionmodule</span><span class="o">.</span><span class="n">calibration_height</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1">#change high-res ROI</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_highres</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_ac_settings_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Full Chip&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_height</span> <span class="o">=</span> <span class="n">Camera_parameters</span><span class="o">.</span><span class="n">HR_height_pixel</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_width</span> <span class="o">=</span> <span class="n">Camera_parameters</span><span class="o">.</span><span class="n">HR_width_pixel</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">highres_camera</span><span class="o">.</span><span class="n">set_imageroi</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Camera_parameters</span><span class="o">.</span><span class="n">HR_width_pixel</span><span class="p">,</span>
                                                          <span class="n">Camera_parameters</span><span class="o">.</span><span class="n">HR_height_pixel</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_ac_settings_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;1024x1024&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_height</span> <span class="o">=</span> <span class="mi">1024</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_width</span> <span class="o">=</span> <span class="mi">1024</span>
                    <span class="n">startx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Camera_parameters</span><span class="o">.</span><span class="n">HR_width_pixel</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">512</span>
                    <span class="n">starty</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Camera_parameters</span><span class="o">.</span><span class="n">HR_height_pixel</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">512</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">highres_camera</span><span class="o">.</span><span class="n">set_imageroi</span><span class="p">(</span><span class="n">startx</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_ac_settings_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;512x512&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_height</span> <span class="o">=</span> <span class="mi">512</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_width</span> <span class="o">=</span> <span class="mi">512</span>
                    <span class="n">startx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Camera_parameters</span><span class="o">.</span><span class="n">HR_width_pixel</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">256</span>
                    <span class="n">starty</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Camera_parameters</span><span class="o">.</span><span class="n">HR_height_pixel</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">256</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">highres_camera</span><span class="o">.</span><span class="n">set_imageroi</span><span class="p">(</span><span class="n">startx</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_ac_settings_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;256x256&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_height</span> <span class="o">=</span> <span class="mi">256</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_width</span> <span class="o">=</span> <span class="mi">256</span>
                    <span class="n">startx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Camera_parameters</span><span class="o">.</span><span class="n">HR_width_pixel</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">128</span>
                    <span class="n">starty</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Camera_parameters</span><span class="o">.</span><span class="n">HR_height_pixel</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">128</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">highres_camera</span><span class="o">.</span><span class="n">set_imageroi</span><span class="p">(</span><span class="n">startx</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_ac_settings_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Usual&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_height</span> <span class="o">=</span> <span class="mi">1024</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_width</span> <span class="o">=</span> <span class="mi">2048</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">highres_camera</span><span class="o">.</span><span class="n">set_imageroi</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_ac_settings_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Custom&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_height</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_width</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                    <span class="n">startx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_startX</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                    <span class="n">starty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">roi_startY</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">highres_camera</span><span class="o">.</span><span class="n">set_imageroi</span><span class="p">(</span><span class="n">startx</span><span class="p">,</span> <span class="n">starty</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_height</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.run_lowrespreview"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.run_lowrespreview">[docs]</a>    <span class="k">def</span> <span class="nf">run_lowrespreview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Runs the execution of a low resolution preview.</span>
<span class="sd">        Required:</span>
<span class="sd">        change mirror, start preview, set continue_preview_highres to True.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1">#end highres preview</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_highres</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_preview_highres</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;raised&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_lowres</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1">#change mirror position/slit position</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">changeHRtoLR</span><span class="p">()</span>

            <span class="c1"># set parameter that you run a preview</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_lowres</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1">#self.model.laserOn = self.current_laser</span>

            <span class="c1">#set button layout - sunken relief</span>
            <span class="k">def</span> <span class="nf">set_button</span><span class="p">():</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.002</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_preview_lowres</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;sunken&quot;</span><span class="p">)</span>
            <span class="n">ct</span><span class="o">.</span><span class="n">ResultThread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">set_button</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="c1">#run preview with given parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">preview_lowres</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;running lowres preview&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.run_highrespreview"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.run_highrespreview">[docs]</a>    <span class="k">def</span> <span class="nf">run_highrespreview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Runs the execution of a high resolution preview.</span>
<span class="sd">        Required:</span>
<span class="sd">        change mirror, set exposure time, start preview, set continue_preview_highres to True.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1">#end highres preview</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_lowres</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_preview_lowres</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;raised&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_highres</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1"># change mirror position/slit position</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">changeLRtoHR</span><span class="p">()</span>

            <span class="c1"># set parameter that you run a preview</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_highres</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1">#self.model.laserOn = self.current_laser</span>

            <span class="c1">#set button layout - sunken relief</span>
            <span class="k">def</span> <span class="nf">set_buttonHR</span><span class="p">():</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.002</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_preview_highres</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;sunken&quot;</span><span class="p">)</span>
            <span class="n">ct</span><span class="o">.</span><span class="n">ResultThread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">set_buttonHR</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="c1">#run preview with given parameters</span>

            <span class="c1">#ASLM or static light-sheet mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">cam_highresMode</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;SPIM Mode&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">preview_highres_static</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;running high res static preview&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">preview_highres_ASLM</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;running high res ASLM preview&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.updatepreview"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.updatepreview">[docs]</a>    <span class="k">def</span> <span class="nf">updatepreview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">indx</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Updates preview functionalities: auto-scaling of intensity values</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">preview_autoIntensity</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">autoscale_preview</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;updated ---------------------------------------1&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">autoscale_preview</span> <span class="o">=</span><span class="mi">0</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.run_stop_preview"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.run_stop_preview">[docs]</a>    <span class="k">def</span> <span class="nf">run_stop_preview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Stops an executing preview and resets the profile of the preview buttons that were sunken after starting a preview</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_lowres</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_lowres</span> <span class="o">=</span><span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">preview_change</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_preview_lowres</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_highres</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_highres</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">preview_change</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">bt_preview_highres</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.movestage"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.movestage">[docs]</a>    <span class="k">def</span> <span class="nf">movestage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        moves the stage to a certain position</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#get positions from GUI and constract position array &quot;moveToPosition&quot;</span>
        <span class="n">lateralPosition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_lateral</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000000</span>
        <span class="n">updownPosition</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_updown</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000000</span>
        <span class="n">axialPosition</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_axial</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000000</span>
        <span class="n">anglePosition</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_angle</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000</span>
        <span class="n">moveToPosition</span> <span class="o">=</span> <span class="p">[</span><span class="n">axialPosition</span><span class="p">,</span> <span class="n">lateralPosition</span><span class="p">,</span> <span class="n">updownPosition</span><span class="p">,</span> <span class="n">anglePosition</span><span class="p">]</span>

        <span class="c1">#check not to exceed limits</span>
        <span class="n">moveToPosition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">check_movementboundaries</span><span class="p">(</span><span class="n">moveToPosition</span><span class="p">)</span>

        <span class="c1">#move</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">moveToPosition</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.movestageToPosition"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.movestageToPosition">[docs]</a>    <span class="k">def</span> <span class="nf">movestageToPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        moves the stage to a saved position, indicated by a field in the GUI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_move_to_specificposition</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">move_to_specific_pos_resolution</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;on&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;move:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">)):</span>
                <span class="n">savedpos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">savedpos</span> <span class="o">==</span> <span class="n">position</span><span class="p">:</span>
                    <span class="c1">#set positions in the moving panel:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_lateral</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_updown</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_axial</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_angle</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
                    <span class="c1">#move to these positions:</span>
                    <span class="n">xpos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000000000</span><span class="p">)</span>
                    <span class="n">ypos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000000000</span><span class="p">)</span>
                    <span class="n">zpos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000000000</span><span class="p">)</span>
                    <span class="n">angle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">)</span>
                    <span class="n">current_position</span> <span class="o">=</span> <span class="p">[</span><span class="n">zpos</span><span class="p">,</span> <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">angle</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">current_position</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">)):</span>
                <span class="n">savedpos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">savedpos</span> <span class="o">==</span> <span class="n">position</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_lateral</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_updown</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_axial</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_angle</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>

                    <span class="n">xpos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000000000</span><span class="p">)</span>
                    <span class="n">ypos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000000000</span><span class="p">)</span>
                    <span class="n">zpos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000000000</span><span class="p">)</span>
                    <span class="n">angle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">)</span>
                    <span class="n">current_position</span> <span class="o">=</span> <span class="p">[</span><span class="n">zpos</span><span class="p">,</span> <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">angle</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">current_position</span><span class="p">)</span></div>

    <span class="c1"># def slit_opening_move(self, var,indx, mode):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     changes the slit opening</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     currentslitopening = self.view.advancedSettingstab.slit_currentsetting.get()</span>
    <span class="c1">#     self.model.move_adjustableslit(currentslitopening)</span>
    <span class="c1">#     self.view.advancedSettingstab.slit_currentsetting.set(currentslitopening)</span>


<div class="viewcode-block" id="MultiScale_Microscope_Controller.changefilter"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.changefilter">[docs]</a>    <span class="k">def</span> <span class="nf">changefilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">laser</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        changes the filter to the specified one by the laser active</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;change filter to laser: &quot;</span> <span class="o">+</span> <span class="n">laser</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">laser</span> <span class="o">==</span> <span class="s1">&#39;488&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">LED_voltage</span><span class="o">.</span><span class="n">setconstantvoltage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">filterwheel</span><span class="o">.</span><span class="n">set_filter</span><span class="p">(</span><span class="s1">&#39;515-30-25&#39;</span><span class="p">,</span> <span class="n">wait_until_done</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_laser</span> <span class="o">=</span> <span class="n">NI_board_parameters</span><span class="o">.</span><span class="n">laser488</span>
        <span class="k">if</span> <span class="n">laser</span> <span class="o">==</span> <span class="s1">&#39;552&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">LED_voltage</span><span class="o">.</span><span class="n">setconstantvoltage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">filterwheel</span><span class="o">.</span><span class="n">set_filter</span><span class="p">(</span><span class="s1">&#39;572/20-25&#39;</span><span class="p">,</span> <span class="n">wait_until_done</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_laser</span> <span class="o">=</span> <span class="n">NI_board_parameters</span><span class="o">.</span><span class="n">laser552</span>
        <span class="k">if</span> <span class="n">laser</span> <span class="o">==</span> <span class="s1">&#39;594&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">LED_voltage</span><span class="o">.</span><span class="n">setconstantvoltage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">filterwheel</span><span class="o">.</span><span class="n">set_filter</span><span class="p">(</span><span class="s1">&#39;615/20-25&#39;</span><span class="p">,</span> <span class="n">wait_until_done</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_laser</span> <span class="o">=</span> <span class="n">NI_board_parameters</span><span class="o">.</span><span class="n">laser594</span>
        <span class="k">if</span> <span class="n">laser</span> <span class="o">==</span> <span class="s1">&#39;640&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">LED_voltage</span><span class="o">.</span><span class="n">setconstantvoltage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">filterwheel</span><span class="o">.</span><span class="n">set_filter</span><span class="p">(</span><span class="s1">&#39;676/37-25&#39;</span><span class="p">,</span> <span class="n">wait_until_done</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_laser</span> <span class="o">=</span> <span class="n">NI_board_parameters</span><span class="o">.</span><span class="n">laser640</span>
        <span class="k">if</span> <span class="n">laser</span> <span class="o">==</span><span class="s1">&#39;LED&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">filterwheel</span><span class="o">.</span><span class="n">set_filter</span><span class="p">(</span><span class="s1">&#39;515-30-25&#39;</span><span class="p">,</span> <span class="n">wait_until_done</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">LED_voltage</span><span class="o">.</span><span class="n">setconstantvoltage</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_laser</span> <span class="o">=</span> <span class="n">NI_board_parameters</span><span class="o">.</span><span class="n">led</span></div>


<div class="viewcode-block" id="MultiScale_Microscope_Controller.updatefilename"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.updatefilename">[docs]</a>    <span class="k">def</span> <span class="nf">updatefilename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        construct the filename used to save data, based on the information from the GUI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parentdir</span> <span class="o">=</span> <span class="n">FileSave_parameters</span><span class="o">.</span><span class="n">parentdir</span>

        <span class="n">modelorganism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">welcometab</span><span class="o">.</span><span class="n">welcome_modelorganism</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">welcometab</span><span class="o">.</span><span class="n">welcome_username</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="n">foldername</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">modelorganism</span>
        <span class="k">if</span> <span class="n">username</span> <span class="o">==</span> <span class="s2">&quot;Stephan Daetwyler&quot;</span><span class="p">:</span>
            <span class="n">foldername</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="s2">&quot;_Daetwyler_&quot;</span> <span class="o">+</span> <span class="n">modelorganism</span>
        <span class="k">if</span> <span class="n">username</span> <span class="o">==</span> <span class="s2">&quot;Reto Fiolka&quot;</span><span class="p">:</span>
            <span class="n">foldername</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="s2">&quot;_Fiolka_&quot;</span> <span class="o">+</span> <span class="n">modelorganism</span>
        <span class="k">if</span> <span class="n">username</span> <span class="o">==</span> <span class="s2">&quot;Bo-Jui Chang&quot;</span><span class="p">:</span>
            <span class="n">foldername</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="s2">&quot;_Chang_&quot;</span> <span class="o">+</span> <span class="n">modelorganism</span>
        <span class="k">if</span> <span class="n">username</span> <span class="o">==</span> <span class="s2">&quot;Dagan Segal&quot;</span><span class="p">:</span>
            <span class="n">foldername</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="s2">&quot;_Segal_&quot;</span> <span class="o">+</span> <span class="n">modelorganism</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parentfolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parentdir</span><span class="p">,</span> <span class="n">foldername</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.acquire_stack"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.acquire_stack">[docs]</a>    <span class="k">def</span> <span class="nf">acquire_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        start a stack acquisition thread</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">abortStackFlag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ct</span><span class="o">.</span><span class="n">ResultThread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">acquire_stack_task</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.abort_stack"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.abort_stack">[docs]</a>    <span class="k">def</span> <span class="nf">abort_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set flag to abort stack acquisition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">abortStackFlag</span> <span class="o">=</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="MultiScale_Microscope_Controller.acquire_stack_task"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.acquire_stack_task">[docs]</a>    <span class="k">def</span> <span class="nf">acquire_stack_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        acquire a stack acquisition - processes in thread (to not stop GUI from working)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_bt_run_stack</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;sunken&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatefilename</span><span class="p">()</span>

        <span class="c1">#stop all potential previews</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_lowres</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_highres</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#overwrite abortStackFlag if pressed before</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">abortStackFlag</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#some parameters.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">displayImStack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_displayON</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="c1">#whether to display images during stack acq or not</span>

        <span class="c1">#set driftcorrection settings - set completed array back to zero and update position lists in module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">driftcorrectionmodule</span><span class="o">.</span><span class="n">completed</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">driftcorrectionmodule</span><span class="o">.</span><span class="n">highres_positionList</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">driftcorrectionmodule</span><span class="o">.</span><span class="n">lowres_positionList</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">)</span>

        <span class="c1">#save acquistition parameters and construct file name to save (only if not time-lapse)</span>
        <span class="n">stackfilepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentfolder</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">continuetimelapse</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

            <span class="c1"># generate file path</span>
            <span class="n">nbfiles_folder</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parentfolder</span><span class="p">,</span> <span class="s1">&#39;Experiment*&#39;</span><span class="p">)))</span>
            <span class="n">newfolderind</span> <span class="o">=</span> <span class="n">nbfiles_folder</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c1"># catch errors when deleting Experiment names before</span>
            <span class="k">def</span> <span class="nf">set_experiment_name</span><span class="p">(</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">experimentnumber</span><span class="p">):</span>
                <span class="n">experiment_name</span> <span class="o">=</span> <span class="s2">&quot;Experiment&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">experimentnumber</span><span class="si">:</span><span class="s1">04</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
                <span class="n">isExist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">isExist</span><span class="p">:</span>
                    <span class="n">experiment_name</span> <span class="o">=</span> <span class="n">set_experiment_name</span><span class="p">(</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">experimentnumber</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">experiment_name</span>

            <span class="n">experiment_name</span> <span class="o">=</span> <span class="n">set_experiment_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">newfolderind</span><span class="p">)</span>

            <span class="c1">#write acquisition parameters</span>
            <span class="n">filepath_write_acquisitionParameters</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;filepath : &quot;</span> <span class="o">+</span> <span class="n">filepath_write_acquisitionParameters</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">filepath_write_acquisitionParameters</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File writing error&quot;</span><span class="p">)</span>

            <span class="c1">#write parameters in a thread</span>
            <span class="k">def</span> <span class="nf">write_paramconfig</span><span class="p">():</span>
                <span class="n">lowresroi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_height</span><span class="p">]</span>
                <span class="n">highresroi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_height</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paramwriter</span><span class="o">.</span><span class="n">write_to_textfile</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filepath_write_acquisitionParameters</span><span class="p">,</span> <span class="s1">&#39;Experiment_settings.txt&#39;</span><span class="p">),</span> <span class="n">lowresroi</span><span class="p">,</span>
                    <span class="n">highresroi</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;parameters saved&quot;</span><span class="p">)</span>
            <span class="n">ct</span><span class="o">.</span><span class="n">ResultThread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">write_paramconfig</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="c1">#set timepoint = 0 to be consistent with time-lapse acquisitions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_timepointstring</span> <span class="o">=</span> <span class="s2">&quot;t00000&quot;</span>
            <span class="n">stackfilepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">,</span> <span class="s2">&quot;t00000&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">experimentfilepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">stackfilepath</span><span class="p">)</span>

            <span class="c1">#no need for drift correction if single stack is acquired</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">drift_correctionOnHighRes</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># parameter whether high res drift correction is enabled</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">drift_correctionOnLowRes</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># parameter whether low res drift correction is enabled</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stackfilepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_timelapse_filepath</span>

        <span class="c1">########-------------------------------------------------------------------------------------------------------</span>
        <span class="c1">#start low resolution stack acquisition</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_lowResCameraOn</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;acquiring low res stack&quot;</span><span class="p">)</span>

            <span class="c1"># change mirror position/slit position</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">changeHRtoLR</span><span class="p">()</span>

            <span class="c1">#iterate over all positions in the low res Position list</span>
            <span class="n">positioniter</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">)):</span>
                <span class="c1">#get current position from list</span>
                <span class="n">current_startposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="n">positioniter</span> <span class="o">=</span> <span class="n">positioniter</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c1"># filepath</span>
                <span class="n">current_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stackfilepath</span><span class="p">,</span> <span class="s2">&quot;low_stack&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">positioniter</span><span class="si">:</span><span class="s1">03</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="c1">#update info for filepath for projections and drift correction</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_region</span> <span class="o">=</span>  <span class="s2">&quot;low_stack&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">positioniter</span><span class="si">:</span><span class="s1">03</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_PosNumber</span> <span class="o">=</span> <span class="n">positioniter</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;filepath : &quot;</span> <span class="o">+</span> <span class="n">current_folder</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">current_folder</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File writing error&quot;</span><span class="p">)</span>

                <span class="c1">#start stackstreaming</span>
                <span class="n">which_channels</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_488onLowRes</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_552onLowRes</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_594onLowRes</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_640onLowRes</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_LEDonLowRes</span><span class="o">.</span><span class="n">get</span><span class="p">()]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">stack_acquisition_master</span><span class="p">(</span><span class="n">current_folder</span><span class="p">,</span> <span class="n">current_startposition</span><span class="p">,</span> <span class="n">which_channels</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">)</span>


        <span class="c1">#################-----------------------------------------------------------------------------------------------</span>
        <span class="c1">#wait for all drift correction positions to be calculated before proceeding to high resolution imaging</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">continuetimelapse</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#call here drift correction if based on low resolution imaging</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">automatedMicroscopySettingstab</span><span class="o">.</span><span class="n">drift_correction_lowres</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wait until drift correction is calculated&quot;</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">driftcorrectionmodule</span><span class="o">.</span><span class="n">completed</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">driftcorrectionmodule</span><span class="o">.</span><span class="n">completed</span><span class="p">):</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">continuetimelapse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">break</span>

                <span class="c1">#update stage position list by taking latest list from driftcorrectionmodule</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">driftcorrectionmodule</span><span class="o">.</span><span class="n">highres_positionList</span>


        <span class="c1">########-------------------------------------------------------------------------------------------------------</span>
        <span class="c1"># start high resolution stack acquisition</span>
        <span class="c1">#high resolution list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_highResCameraOn</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># change mirror position/slit position</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">changeLRtoHR</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;acquiring high res stack&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">)):</span>
                <span class="c1">#get position</span>
                <span class="n">currentposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>

                <span class="c1">#define highresolution stack file path label by label position in file position tree</span>
                <span class="c1">#(can be updated e.g. if you have automatic detection during timelapse)</span>
                <span class="n">pos_label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_highres_PositionList</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span>

                <span class="c1"># filepath</span>
                <span class="n">current_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stackfilepath</span><span class="p">,</span> <span class="s2">&quot;high_stack_&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">pos_label</span><span class="si">:</span><span class="s1">03</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;filepath : &quot;</span> <span class="o">+</span> <span class="n">current_folder</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">current_folder</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File writing error&quot;</span><span class="p">)</span>

                <span class="c1"># update info for filepath for projections and drift correction</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_region</span> <span class="o">=</span> <span class="s2">&quot;high_stack_&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">pos_label</span><span class="si">:</span><span class="s1">03</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_PosNumber</span> <span class="o">=</span> <span class="n">pos_label</span>

                <span class="c1"># start stackstreaming</span>
                <span class="n">which_channels</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_488onHighRes</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_552onHighRes</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_594onHighRes</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_640onHighRes</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_LEDonHighRes</span><span class="o">.</span><span class="n">get</span><span class="p">()]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">cam_highresMode</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;SPIM Mode&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">stack_acquisition_master</span><span class="p">(</span><span class="n">current_folder</span><span class="p">,</span> <span class="n">currentposition</span><span class="p">,</span> <span class="n">which_channels</span><span class="p">,</span> <span class="s2">&quot;highSPIM&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">stack_acquisition_master</span><span class="p">(</span><span class="n">current_folder</span><span class="p">,</span> <span class="n">currentposition</span><span class="p">,</span> <span class="n">which_channels</span><span class="p">,</span> <span class="s2">&quot;highASLM&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">stack_aq_bt_run_stack</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;raised&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">LED_voltage</span><span class="o">.</span><span class="n">setconstantvoltage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="MultiScale_Microscope_Controller.acquire_timelapse"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.acquire_timelapse">[docs]</a>    <span class="k">def</span> <span class="nf">acquire_timelapse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        start a time-lapse acquisition thread, called from GUI (otherwise it freezes)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#update GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">updateTimesTimelapse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_progressbar</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">maximum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_nbTimepoints</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatefilename</span><span class="p">()</span>

        <span class="c1"># set button layout - sunken relief</span>
        <span class="k">def</span> <span class="nf">set_buttonTL</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.002</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_bt_run_timelapse</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;sunken&quot;</span><span class="p">)</span>
        <span class="n">ct</span><span class="o">.</span><span class="n">ResultThread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">set_buttonTL</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># stop all potential previews</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_lowres</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">continue_preview_highres</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">continuetimelapse</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;acquiring timelapse&quot;</span><span class="p">)</span>

        <span class="c1">#(1) NOTE: You cannot use a While loop here as it makes the Tkinter mainloop freeze - put the time-lapse instead into a thread</span>
        <span class="c1">#(2) where you can run while loops etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timelapse_thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_timelapse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timelapse_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>
        <span class="c1">#after that main loop continues</span>


<div class="viewcode-block" id="MultiScale_Microscope_Controller.run_timelapse"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.run_timelapse">[docs]</a>    <span class="k">def</span> <span class="nf">run_timelapse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        thread that controls time-lapse, started from function acquire_timelapse, which is called from GUI(self, event):</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># generate file path</span>
        <span class="n">nbfiles_folder</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parentfolder</span><span class="p">,</span> <span class="s1">&#39;Experiment*&#39;</span><span class="p">)))</span>
        <span class="n">newfolderind</span> <span class="o">=</span> <span class="n">nbfiles_folder</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># generate experiment name - the recursive loop is required to catch errors when deleting Experiment names before</span>
        <span class="k">def</span> <span class="nf">set_experiment_name</span><span class="p">(</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">experimentnumber</span><span class="p">):</span>
            <span class="n">experiment_name</span> <span class="o">=</span> <span class="s2">&quot;Experiment&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">experimentnumber</span><span class="si">:</span><span class="s1">04</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
            <span class="n">isExist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">isExist</span><span class="p">:</span>
                <span class="n">experiment_name</span> <span class="o">=</span> <span class="n">set_experiment_name</span><span class="p">(</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">experimentnumber</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">experiment_name</span>

        <span class="n">experiment_name</span> <span class="o">=</span> <span class="n">set_experiment_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">newfolderind</span><span class="p">)</span>
        <span class="n">experimentpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>

        <span class="c1"># generate filepath and folder for writing acquisition parameters</span>
        <span class="n">filepath_write_acquisitionParameters</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parentfolder</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;filepath : &quot;</span> <span class="o">+</span> <span class="n">filepath_write_acquisitionParameters</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">filepath_write_acquisitionParameters</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File writing error&quot;</span><span class="p">)</span>

        <span class="c1"># write acquisition parameters in a thread</span>
        <span class="k">def</span> <span class="nf">write_paramconfigtimelapse</span><span class="p">():</span>
            <span class="n">lowresroi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_lowresROI_height</span><span class="p">]</span>
            <span class="n">highresroi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_highresROI_height</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paramwriter</span><span class="o">.</span><span class="n">write_to_textfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filepath_write_acquisitionParameters</span><span class="p">,</span> <span class="s1">&#39;Experiment_settings.txt&#39;</span><span class="p">),</span><span class="n">lowresroi</span><span class="p">,</span> <span class="n">highresroi</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;parameters saved&quot;</span><span class="p">)</span>
        <span class="n">ct</span><span class="o">.</span><span class="n">ResultThread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">write_paramconfigtimelapse</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1">#driftcorrection - reinitalize image repository so that not old images are used for comparison and set logfolder path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">driftcorrectionmodule</span><span class="o">.</span><span class="n">ImageRepo</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logfolderpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">experimentpath</span><span class="p">,</span> <span class="s1">&#39;driftcorrection_log&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;drift correction logfolder : &quot;</span> <span class="o">+</span> <span class="n">logfolderpath</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">driftcorrectionmodule</span><span class="o">.</span><span class="n">logfolder</span> <span class="o">=</span> <span class="n">logfolderpath</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">logfolderpath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error generating logfolder&quot;</span><span class="p">)</span>

        <span class="c1">###run timelapse, starting at timepoint 0</span>
        <span class="k">for</span> <span class="n">timeiter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_nbTimepoints</span><span class="p">):</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

            <span class="c1">#generate timepoint strings</span>
            <span class="n">numStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timeiter</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">pastStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timeiter</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_timepointstring</span> <span class="o">=</span> <span class="s2">&quot;t&quot;</span> <span class="o">+</span> <span class="n">numStr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">past_timepointstring</span> <span class="o">=</span> <span class="s2">&quot;t&quot;</span> <span class="o">+</span> <span class="n">pastStr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_timelapse_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">experimentpath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_timepointstring</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">experimentfilepath</span> <span class="o">=</span> <span class="n">experimentpath</span> <span class="c1">#for projection</span>

            <span class="c1">#update GUI about timelapse progress</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_progress</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">timeiter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_progressindicator</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">timeiter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot; of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_nbTimepoints</span><span class="p">))</span>

            <span class="n">timeinterval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_timeinterval_min</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_timeinterval_seconds</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time interval:&quot;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timeinterval</span><span class="p">))</span>

            <span class="c1">## stop time-lapse acquisition if you stop it</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">continuetimelapse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>  <span class="c1"># Break while loop when stop = 1</span>

            <span class="c1">#start stack acquisition and wait for it to finish before continuing with next stack acquisition</span>
            <span class="n">stackacquisitionthread</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ResultThread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">acquire_stack_task</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">stackacquisitionthread</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span>

            <span class="c1">#calculate the time until next stack acquisition starts and wait for the time counter to progress</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
            <span class="n">totaltime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_timeinterval_min</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_timeinterval_seconds</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

            <span class="n">remaining_waittime</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">remaining_waittime</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">continuetimelapse</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
                <span class="n">remaining_waittime</span> <span class="o">=</span> <span class="n">totaltime</span> <span class="o">-</span> <span class="n">t1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">continuetimelapse</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">runtab</span><span class="o">.</span><span class="n">timelapse_aq_bt_run_timelapse</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;raised&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>


<div class="viewcode-block" id="MultiScale_Microscope_Controller.abort_timelapse"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.abort_timelapse">[docs]</a>    <span class="k">def</span> <span class="nf">abort_timelapse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">continuetimelapse</span> <span class="o">=</span> <span class="mi">1</span></div>


<span class="c1">#enable keyboard movements ---------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="MultiScale_Microscope_Controller.enable_keyboard_movement"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.enable_keyboard_movement">[docs]</a>    <span class="k">def</span> <span class="nf">enable_keyboard_movement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Key&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.disable_keyboard_movement"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.disable_keyboard_movement">[docs]</a>    <span class="k">def</span> <span class="nf">disable_keyboard_movement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">unbind</span><span class="p">(</span><span class="s2">&quot;&lt;Key&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="MultiScale_Microscope_Controller.key_pressed"><a class="viewcode-back" href="../multiScale_main.html#multiScale_main.MultiScale_Microscope_Controller.key_pressed">[docs]</a>    <span class="k">def</span> <span class="nf">key_pressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">keysym</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">keysym</span> <span class="o">==</span><span class="s2">&quot;Up&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">change_currentposition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_updown</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_last_key</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">keysym</span> <span class="o">==</span><span class="s2">&quot;Down&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">change_currentposition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_updown</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_last_key</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span><span class="s2">&quot;a&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">keysym</span> <span class="o">==</span><span class="s2">&quot;Left&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">change_currentposition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_lateral</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_last_key</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">keysym</span> <span class="o">==</span><span class="s2">&quot;Right&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">change_currentposition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_lateral</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_last_key</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;q&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">change_currentposition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_axial</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_last_key</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;e&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">change_currentposition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_moveto_axial</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">stagessettingstab</span><span class="o">.</span><span class="n">stage_last_key</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">MultiScale_Microscope_Controller</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>





</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Stephan Daetwyler, Reto Fiolka.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>